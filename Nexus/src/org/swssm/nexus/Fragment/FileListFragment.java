package org.swssm.nexus.Fragment;import org.swssm.nexus.R;import org.swssm.nexus.FileStreaming.FileListAdapter;import android.app.Activity;import android.app.Fragment;import android.content.Intent;import android.os.Bundle;import android.os.Handler;import android.os.Message;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.AdapterView;import android.widget.AdapterView.OnItemClickListener;import android.widget.Button;import android.widget.ListView;import com.swssm.NexusLib.Object.Directory;import com.swssm.NexusLib.Object.File;import com.swssm.NexusLib.network.EnvData;import com.swssm.NexusLib.network.FileStreamingNetwork;public class FileListFragment extends Fragment {	// Intent Flag	public static final String TYPE = "type";	public static final int FILE = 2;	public static final String FILE_PATH = "filepath";		ListView mFileList;	FileStreamingNetwork mFileStreamingNetwork;	String mCurrentDir;	FileListAdapter mAdapter;	Directory mDir;		Button btn_home;	Button btn_Up;		public final static String ServerURL = "http://192.168.0.155:3030";		@Override	public View onCreateView(LayoutInflater inflater, ViewGroup container,			Bundle savedInstanceState) {		View v = inflater.inflate(R.layout.fragment_file_list, container, false);				mFileList = (ListView) v.findViewById(R.id.lv_file_list);		mFileList.setOnItemClickListener(listener);				btn_home = (Button) v.findViewById(R.id.btn_home);		btn_Up = (Button) v.findViewById(R.id.btn_up_folder);				btn_home.setOnClickListener(clistener);		btn_Up.setOnClickListener(clistener);				mCurrentDir = "/";		return v;	}		@Override	public void onAttach(Activity activity) {		super.onAttach(activity);	}			@Override	public void onResume() {		super.onResume();		requestFileList(null);	}		@Override	public void onPause() {		super.onPause();		if(mFileStreamingNetwork!=null) {			mFileStreamingNetwork.disconnect();			mFileStreamingNetwork=null;		}	}		Handler mHandler = new Handler() {		@Override		public void handleMessage(Message msg) {			switch(msg.what) {			case EnvData.EVENT_HANDLER.FILE_LIST_COMPLETE:				mDir = (Directory) msg.obj;				setFileList(mDir);				break;			}		}	};		public void setFileList(Directory dir) {		mAdapter = new FileListAdapter(getActivity(), dir);		mFileList.setAdapter(mAdapter);		mFileList.invalidate();	}			public void requestFileList(String path) {		if(mFileStreamingNetwork==null) {			mFileStreamingNetwork = new FileStreamingNetwork(getActivity(), ServerURL, mHandler);			mCurrentDir = "/";		}				if(path == null) path = "/";				mCurrentDir = path;		mFileStreamingNetwork.connect();		mFileStreamingNetwork.requestFileList(mCurrentDir);	}		OnItemClickListener listener = new OnItemClickListener() {		public void onItemClick(AdapterView<?> parent, View view, int position,				long id) {			mDir = (Directory) parent.getItemAtPosition(position);						if(id == FileListAdapter.DIRECTORY_ID) {				String dirName = mDir.getDirList().get(position);				String nextDirPath = mDir.getParentDirPath() + mDir.getDirName() + "/" + dirName;				requestFileList(nextDirPath);							} 						else if(id == FileListAdapter.FILE_ID) {								File file = mDir.getFileList().get(position - mDir.getDirList().size()); 								String filePath = mDir.getParentDirPath() + mDir.getDirName() + "/" + 						file.getFileName() + "." + file.getExtension();								Intent intent = getActivity().getPackageManager().getLaunchIntentForPackage("org.swssm.nexusPlayer");				intent.putExtra(TYPE, FILE);				intent.putExtra(FILE_PATH, filePath);				startActivity(intent);			}		}	};		View.OnClickListener clistener = new View.OnClickListener() {		@Override		public void onClick(View v) {			switch(v.getId()) {			case R.id.btn_home:				requestFileList("/");				break;			case R.id.btn_up_folder:								if(mDir!=null) {					String nextDirPath = mDir.getParentDirPath();					requestFileList(nextDirPath);				}				break;			}		}	};}